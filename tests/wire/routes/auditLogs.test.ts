/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../mock-server/MockServerPool.js";
import { SamsaraApiClient } from "../../../src/Client";

describe("AuditLogs", () => {
    test("feed", async () => {
        const server = mockServerPool.createServer();
        const client = new SamsaraApiClient({ token: "test", version: "2025-05-12", environment: server.baseUrl });

        const rawResponseBody = {
            data: [
                {
                    changes: {
                        after: {
                            stops: [
                                {
                                    actualArrivalTime: "2006-01-02T08:04:05Z",
                                    actualDepartureTime: "2006-01-02T08:04:05Z",
                                    enRouteTime: "2006-01-02T08:04:05Z",
                                    eta: "2006-01-02T08:04:05Z",
                                    id: "141414",
                                    liveSharingUrl: "https://cloud.samsara.com/fleet/viewer/job/fleet_viewer_token",
                                    scheduledArrivalTime: "2019-06-13T19:08:25Z",
                                    scheduledDepartureTime: "2019-06-13T19:08:25Z",
                                    skippedTime: "2006-01-02T08:04:05Z",
                                },
                            ],
                        },
                        before: {
                            stops: [
                                {
                                    actualArrivalTime: "2006-01-02T08:04:05Z",
                                    actualDepartureTime: "2006-01-02T08:04:05Z",
                                    enRouteTime: "2006-01-02T08:04:05Z",
                                    eta: "2006-01-02T08:04:05Z",
                                    id: "141414",
                                    liveSharingUrl: "https://cloud.samsara.com/fleet/viewer/job/fleet_viewer_token",
                                    scheduledArrivalTime: "2019-06-13T19:08:25Z",
                                    scheduledDepartureTime: "2019-06-13T19:08:25Z",
                                    skippedTime: "2006-01-02T08:04:05Z",
                                },
                            ],
                        },
                    },
                    operation: "stop scheduled",
                    route: {
                        actualRouteEndTime: "2019-06-13T19:08:25Z",
                        actualRouteStartTime: "2019-06-13T19:08:25Z",
                        driver: { id: "45646", name: "Driver Bob" },
                        id: "342341",
                        name: "Bid 123",
                        notes: "These are my notes",
                        orgLocalTimezone: "America/Los_Angeles",
                        recurringRouteLiveSharingLinks: [
                            {
                                expiresAtTime: "2020-01-27T07:06:25Z",
                                liveSharingUrl:
                                    "https://cloud.samsara.com/o/123456/fleet/viewer/address/gEAitEnnOwcv92cuPzcU",
                                name: "Name",
                            },
                        ],
                        scheduledRouteEndTime: "2019-06-13T19:08:25Z",
                        scheduledRouteStartTime: "2019-06-13T19:08:25Z",
                        stops: [
                            {
                                actualArrivalTime: "2006-01-02T08:04:05Z",
                                actualDepartureTime: "2006-01-02T08:04:05Z",
                                address: { id: "494123", name: "Company Office #1" },
                                documents: [{ id: "494123", name: "Fuel Receipt Wichita" }],
                                enRouteTime: "2006-01-02T08:04:05Z",
                                eta: "2006-01-02T08:04:05Z",
                                id: "324231",
                                liveSharingUrl: "https://cloud.samsara.com/fleet/viewer/job/fleet_viewer_token",
                                locationLiveSharingLinks: [
                                    {
                                        expiresAtTime: "2020-01-27T07:06:25Z",
                                        liveSharingUrl:
                                            "https://cloud.samsara.com/o/123456/fleet/viewer/address/gEAitEnnOwcv92cuPzcU",
                                        name: "Name",
                                    },
                                ],
                                name: "Stop #1",
                                notes: "These are my notes",
                                ontimeWindowAfterArrivalMs: 300000,
                                ontimeWindowBeforeArrivalMs: 300000,
                                scheduledArrivalTime: "2019-06-13T19:08:25Z",
                                scheduledDepartureTime: "2019-06-13T19:08:25Z",
                                singleUseLocation: {
                                    address: "1234 Main St, San Jose, CA",
                                    latitude: 123.456,
                                    longitude: 37.459,
                                },
                                skippedTime: "2006-01-02T08:04:05Z",
                                state: "unassigned",
                            },
                        ],
                    },
                    source: "automatic",
                    time: "2020-01-27T07:06:25Z",
                    type: "route tracking",
                },
            ],
            pagination: { endCursor: "MjkY", hasNextPage: true },
        };
        server
            .mockEndpoint()
            .get("/fleet/routes/audit-logs/feed")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.routes.auditLogs.feed();
        expect(response).toEqual({
            data: [
                {
                    changes: {
                        after: {
                            stops: [
                                {
                                    actualArrivalTime: "2006-01-02T08:04:05Z",
                                    actualDepartureTime: "2006-01-02T08:04:05Z",
                                    enRouteTime: "2006-01-02T08:04:05Z",
                                    eta: "2006-01-02T08:04:05Z",
                                    id: "141414",
                                    liveSharingUrl: "https://cloud.samsara.com/fleet/viewer/job/fleet_viewer_token",
                                    scheduledArrivalTime: "2019-06-13T19:08:25Z",
                                    scheduledDepartureTime: "2019-06-13T19:08:25Z",
                                    skippedTime: "2006-01-02T08:04:05Z",
                                },
                            ],
                        },
                        before: {
                            stops: [
                                {
                                    actualArrivalTime: "2006-01-02T08:04:05Z",
                                    actualDepartureTime: "2006-01-02T08:04:05Z",
                                    enRouteTime: "2006-01-02T08:04:05Z",
                                    eta: "2006-01-02T08:04:05Z",
                                    id: "141414",
                                    liveSharingUrl: "https://cloud.samsara.com/fleet/viewer/job/fleet_viewer_token",
                                    scheduledArrivalTime: "2019-06-13T19:08:25Z",
                                    scheduledDepartureTime: "2019-06-13T19:08:25Z",
                                    skippedTime: "2006-01-02T08:04:05Z",
                                },
                            ],
                        },
                    },
                    operation: "stop scheduled",
                    route: {
                        actualRouteEndTime: "2019-06-13T19:08:25Z",
                        actualRouteStartTime: "2019-06-13T19:08:25Z",
                        driver: {
                            id: "45646",
                            name: "Driver Bob",
                        },
                        id: "342341",
                        name: "Bid 123",
                        notes: "These are my notes",
                        orgLocalTimezone: "America/Los_Angeles",
                        recurringRouteLiveSharingLinks: [
                            {
                                expiresAtTime: "2020-01-27T07:06:25Z",
                                liveSharingUrl:
                                    "https://cloud.samsara.com/o/123456/fleet/viewer/address/gEAitEnnOwcv92cuPzcU",
                                name: "Name",
                            },
                        ],
                        scheduledRouteEndTime: "2019-06-13T19:08:25Z",
                        scheduledRouteStartTime: "2019-06-13T19:08:25Z",
                        stops: [
                            {
                                actualArrivalTime: "2006-01-02T08:04:05Z",
                                actualDepartureTime: "2006-01-02T08:04:05Z",
                                address: {
                                    id: "494123",
                                    name: "Company Office #1",
                                },
                                documents: [
                                    {
                                        id: "494123",
                                        name: "Fuel Receipt Wichita",
                                    },
                                ],
                                enRouteTime: "2006-01-02T08:04:05Z",
                                eta: "2006-01-02T08:04:05Z",
                                id: "324231",
                                liveSharingUrl: "https://cloud.samsara.com/fleet/viewer/job/fleet_viewer_token",
                                locationLiveSharingLinks: [
                                    {
                                        expiresAtTime: "2020-01-27T07:06:25Z",
                                        liveSharingUrl:
                                            "https://cloud.samsara.com/o/123456/fleet/viewer/address/gEAitEnnOwcv92cuPzcU",
                                        name: "Name",
                                    },
                                ],
                                name: "Stop #1",
                                notes: "These are my notes",
                                ontimeWindowAfterArrivalMs: 300000,
                                ontimeWindowBeforeArrivalMs: 300000,
                                scheduledArrivalTime: "2019-06-13T19:08:25Z",
                                scheduledDepartureTime: "2019-06-13T19:08:25Z",
                                singleUseLocation: {
                                    address: "1234 Main St, San Jose, CA",
                                    latitude: 123.456,
                                    longitude: 37.459,
                                },
                                skippedTime: "2006-01-02T08:04:05Z",
                                state: "unassigned",
                            },
                        ],
                    },
                    source: "automatic",
                    time: "2020-01-27T07:06:25Z",
                    type: "route tracking",
                },
            ],
            pagination: {
                endCursor: "MjkY",
                hasNextPage: true,
            },
        });
    });
});
