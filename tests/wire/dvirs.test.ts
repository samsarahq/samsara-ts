/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../mock-server/MockServerPool.js";
import { SamsaraApiClient } from "../../src/Client";

describe("Dvirs", () => {
    test("get", async () => {
        const server = mockServerPool.createServer();
        const client = new SamsaraApiClient({ token: "test", version: "2025-05-12", environment: server.baseUrl });

        const rawResponseBody = {
            authorSignature: { signatoryUser: { id: "938172" }, signedAtTime: "2020-01-27T07:06:25Z", type: "driver" },
            defectIds: ["8d218e6c-7a16-4f9f-90f7-cc1d93b9e596", "25d6151e-29b5-453e-875a-7c5425332e09"],
            dvirSubmissionBeginTime: "2020-01-27T07:06:25Z",
            dvirSubmissionTime: "2020-01-27T07:06:25Z",
            formattedAddress: "350 Rhode Island St Ste. 400S, San Francisco, CA 94103",
            id: "12345",
            mechanicNotes: "Replaced headlight on passenger side.",
            odometerMeters: 91823,
            safetyStatus: "unknown",
            secondSignature: { signatoryUser: { id: "938172" }, signedAtTime: "2020-01-27T07:06:25Z", type: "driver" },
            thirdSignature: { signatoryUser: { id: "938172" }, signedAtTime: "2020-01-27T07:06:25Z", type: "driver" },
            trailer: { externalIds: { key: "value" }, id: "494123" },
            type: "preTrip",
            updatedAtTime: "2020-01-27T07:06:25Z",
            vehicle: { externalIds: { key: "value" }, id: "494123" },
            walkaroundPhotos: [
                {
                    createdAtTime: "2020-01-27T07:06:25Z",
                    name: "Name 1",
                    url: "https://s3.samsara.com/samsara-driver-media-upload/walkaround-photo-path",
                },
            ],
        };
        server.mockEndpoint().get("/dvirs/id").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.dvirs.get("id");
        expect(response).toEqual({
            authorSignature: {
                signatoryUser: {
                    id: "938172",
                },
                signedAtTime: "2020-01-27T07:06:25Z",
                type: "driver",
            },
            defectIds: ["8d218e6c-7a16-4f9f-90f7-cc1d93b9e596", "25d6151e-29b5-453e-875a-7c5425332e09"],
            dvirSubmissionBeginTime: "2020-01-27T07:06:25Z",
            dvirSubmissionTime: "2020-01-27T07:06:25Z",
            formattedAddress: "350 Rhode Island St Ste. 400S, San Francisco, CA 94103",
            id: "12345",
            mechanicNotes: "Replaced headlight on passenger side.",
            odometerMeters: 91823,
            safetyStatus: "unknown",
            secondSignature: {
                signatoryUser: {
                    id: "938172",
                },
                signedAtTime: "2020-01-27T07:06:25Z",
                type: "driver",
            },
            thirdSignature: {
                signatoryUser: {
                    id: "938172",
                },
                signedAtTime: "2020-01-27T07:06:25Z",
                type: "driver",
            },
            trailer: {
                externalIds: {
                    key: "value",
                },
                id: "494123",
            },
            type: "preTrip",
            updatedAtTime: "2020-01-27T07:06:25Z",
            vehicle: {
                externalIds: {
                    key: "value",
                },
                id: "494123",
            },
            walkaroundPhotos: [
                {
                    createdAtTime: "2020-01-27T07:06:25Z",
                    name: "Name 1",
                    url: "https://s3.samsara.com/samsara-driver-media-upload/walkaround-photo-path",
                },
            ],
        });
    });

    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new SamsaraApiClient({ token: "test", version: "2025-05-12", environment: server.baseUrl });
        const rawRequestBody = { authorId: "11", safetyStatus: "safe", type: "mechanic" };
        const rawResponseBody = {
            data: {
                authorSignature: {
                    signatoryUser: { id: "88668", name: "Susan Bob" },
                    signedAtTime: "2020-01-27T07:06:25Z",
                    type: "driver",
                },
                endTime: "2020-01-27T07:06:25Z",
                id: "7107471",
                licensePlate: "XHK1234",
                location: "350 Rhode Island St Ste. 400S, San Francisco, CA 94103",
                mechanicNotes: "Replaced headlight on passenger side.",
                odometerMeters: 14010293,
                safetyStatus: "safe",
                secondSignature: {
                    signatoryUser: { id: "88668", name: "Susan Bob" },
                    signedAtTime: "2020-01-27T07:06:25Z",
                    type: "driver",
                },
                startTime: "2020-01-27T07:06:25Z",
                thirdSignature: {
                    signatoryUser: { id: "88668", name: "Susan Bob" },
                    signedAtTime: "2020-01-27T07:06:25Z",
                    type: "driver",
                },
                trailer: { id: "123456789", name: "Midwest Trailer #5" },
                trailerDefects: [
                    {
                        comment: "Air Compressor not working",
                        createdAtTime: "2020-01-27T07:06:25Z",
                        defectType: "Air Compressor",
                        id: "18",
                        isResolved: true,
                        mechanicNotes: "Extremely large oddly shaped hole in passenger side window.",
                        mechanicNotesUpdatedAtTime: "2020-01-27T07:06:25Z",
                        resolvedAtTime: "2020-01-27T07:06:25Z",
                    },
                ],
                trailerName: "Midwest Trailer #5",
                type: "preTrip",
                vehicle: {
                    ExternalIds: { maintenanceId: "250020", payrollId: "ABFS18600" },
                    id: "123456789",
                    name: "Midwest Truck #4",
                },
                vehicleDefects: [
                    {
                        comment: "Air Compressor not working",
                        createdAtTime: "2020-01-27T07:06:25Z",
                        defectType: "Air Compressor",
                        id: "18",
                        isResolved: true,
                        mechanicNotes: "Extremely large oddly shaped hole in passenger side window.",
                        mechanicNotesUpdatedAtTime: "2020-01-27T07:06:25Z",
                        resolvedAtTime: "2020-01-27T07:06:25Z",
                    },
                ],
            },
        };
        server
            .mockEndpoint()
            .post("/fleet/dvirs")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.dvirs.create({
            authorId: "11",
            safetyStatus: "safe",
        });
        expect(response).toEqual({
            data: {
                authorSignature: {
                    signatoryUser: {
                        id: "88668",
                        name: "Susan Bob",
                    },
                    signedAtTime: "2020-01-27T07:06:25Z",
                    type: "driver",
                },
                endTime: "2020-01-27T07:06:25Z",
                id: "7107471",
                licensePlate: "XHK1234",
                location: "350 Rhode Island St Ste. 400S, San Francisco, CA 94103",
                mechanicNotes: "Replaced headlight on passenger side.",
                odometerMeters: 14010293,
                safetyStatus: "safe",
                secondSignature: {
                    signatoryUser: {
                        id: "88668",
                        name: "Susan Bob",
                    },
                    signedAtTime: "2020-01-27T07:06:25Z",
                    type: "driver",
                },
                startTime: "2020-01-27T07:06:25Z",
                thirdSignature: {
                    signatoryUser: {
                        id: "88668",
                        name: "Susan Bob",
                    },
                    signedAtTime: "2020-01-27T07:06:25Z",
                    type: "driver",
                },
                trailer: {
                    id: "123456789",
                    name: "Midwest Trailer #5",
                },
                trailerDefects: [
                    {
                        comment: "Air Compressor not working",
                        createdAtTime: "2020-01-27T07:06:25Z",
                        defectType: "Air Compressor",
                        id: "18",
                        isResolved: true,
                        mechanicNotes: "Extremely large oddly shaped hole in passenger side window.",
                        mechanicNotesUpdatedAtTime: "2020-01-27T07:06:25Z",
                        resolvedAtTime: "2020-01-27T07:06:25Z",
                    },
                ],
                trailerName: "Midwest Trailer #5",
                type: "preTrip",
                vehicle: {
                    ExternalIds: {
                        maintenanceId: "250020",
                        payrollId: "ABFS18600",
                    },
                    id: "123456789",
                    name: "Midwest Truck #4",
                },
                vehicleDefects: [
                    {
                        comment: "Air Compressor not working",
                        createdAtTime: "2020-01-27T07:06:25Z",
                        defectType: "Air Compressor",
                        id: "18",
                        isResolved: true,
                        mechanicNotes: "Extremely large oddly shaped hole in passenger side window.",
                        mechanicNotesUpdatedAtTime: "2020-01-27T07:06:25Z",
                        resolvedAtTime: "2020-01-27T07:06:25Z",
                    },
                ],
            },
        });
    });

    test("history", async () => {
        const server = mockServerPool.createServer();
        const client = new SamsaraApiClient({ token: "test", version: "2025-05-12", environment: server.baseUrl });

        const rawResponseBody = {
            data: [
                {
                    authorSignature: { signedAtTime: "2020-01-27T07:06:25Z" },
                    endTime: "2020-01-27T07:06:25Z",
                    id: "7107471",
                    licensePlate: "XHK1234",
                    location: "350 Rhode Island St Ste. 400S, San Francisco, CA 94103",
                    mechanicNotes: "Replaced headlight on passenger side.",
                    odometerMeters: 14010293,
                    safetyStatus: "safe",
                    secondSignature: { signedAtTime: "2020-01-27T07:06:25Z" },
                    startTime: "2020-01-27T07:06:25Z",
                    thirdSignature: { signedAtTime: "2020-01-27T07:06:25Z" },
                    trailer: { id: "123456789", name: "Midwest Trailer #5" },
                    trailerDefects: [
                        {
                            comment: "Air Compressor not working",
                            createdAtTime: "2020-01-27T07:06:25Z",
                            defectType: "Air Compressor",
                            id: "18",
                            isResolved: true,
                            mechanicNotes: "Extremely large oddly shaped hole in passenger side window.",
                            mechanicNotesUpdatedAtTime: "2020-01-27T07:06:25Z",
                            resolvedAtTime: "2020-01-27T07:06:25Z",
                        },
                    ],
                    trailerName: "Midwest Trailer #5",
                    type: "preTrip",
                    vehicle: {
                        ExternalIds: { maintenanceId: "250020", payrollId: "ABFS18600" },
                        id: "123456789",
                        name: "Midwest Truck #4",
                    },
                    vehicleDefects: [
                        {
                            comment: "Air Compressor not working",
                            createdAtTime: "2020-01-27T07:06:25Z",
                            defectType: "Air Compressor",
                            id: "18",
                            isResolved: true,
                            mechanicNotes: "Extremely large oddly shaped hole in passenger side window.",
                            mechanicNotesUpdatedAtTime: "2020-01-27T07:06:25Z",
                            resolvedAtTime: "2020-01-27T07:06:25Z",
                        },
                    ],
                },
            ],
            pagination: { endCursor: "MjkY", hasNextPage: true },
        };
        server
            .mockEndpoint()
            .get("/fleet/dvirs/history")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.dvirs.history({
            startTime: "startTime",
            endTime: "endTime",
        });
        expect(response).toEqual({
            data: [
                {
                    authorSignature: {
                        signedAtTime: "2020-01-27T07:06:25Z",
                    },
                    endTime: "2020-01-27T07:06:25Z",
                    id: "7107471",
                    licensePlate: "XHK1234",
                    location: "350 Rhode Island St Ste. 400S, San Francisco, CA 94103",
                    mechanicNotes: "Replaced headlight on passenger side.",
                    odometerMeters: 14010293,
                    safetyStatus: "safe",
                    secondSignature: {
                        signedAtTime: "2020-01-27T07:06:25Z",
                    },
                    startTime: "2020-01-27T07:06:25Z",
                    thirdSignature: {
                        signedAtTime: "2020-01-27T07:06:25Z",
                    },
                    trailer: {
                        id: "123456789",
                        name: "Midwest Trailer #5",
                    },
                    trailerDefects: [
                        {
                            comment: "Air Compressor not working",
                            createdAtTime: "2020-01-27T07:06:25Z",
                            defectType: "Air Compressor",
                            id: "18",
                            isResolved: true,
                            mechanicNotes: "Extremely large oddly shaped hole in passenger side window.",
                            mechanicNotesUpdatedAtTime: "2020-01-27T07:06:25Z",
                            resolvedAtTime: "2020-01-27T07:06:25Z",
                        },
                    ],
                    trailerName: "Midwest Trailer #5",
                    type: "preTrip",
                    vehicle: {
                        ExternalIds: {
                            maintenanceId: "250020",
                            payrollId: "ABFS18600",
                        },
                        id: "123456789",
                        name: "Midwest Truck #4",
                    },
                    vehicleDefects: [
                        {
                            comment: "Air Compressor not working",
                            createdAtTime: "2020-01-27T07:06:25Z",
                            defectType: "Air Compressor",
                            id: "18",
                            isResolved: true,
                            mechanicNotes: "Extremely large oddly shaped hole in passenger side window.",
                            mechanicNotesUpdatedAtTime: "2020-01-27T07:06:25Z",
                            resolvedAtTime: "2020-01-27T07:06:25Z",
                        },
                    ],
                },
            ],
            pagination: {
                endCursor: "MjkY",
                hasNextPage: true,
            },
        });
    });

    test("update", async () => {
        const server = mockServerPool.createServer();
        const client = new SamsaraApiClient({ token: "test", version: "2025-05-12", environment: server.baseUrl });
        const rawRequestBody = { authorId: "11", isResolved: true };
        const rawResponseBody = {
            data: {
                authorSignature: {
                    signatoryUser: { id: "88668", name: "Susan Bob" },
                    signedAtTime: "2020-01-27T07:06:25Z",
                    type: "driver",
                },
                endTime: "2020-01-27T07:06:25Z",
                id: "7107471",
                licensePlate: "XHK1234",
                location: "350 Rhode Island St Ste. 400S, San Francisco, CA 94103",
                mechanicNotes: "Replaced headlight on passenger side.",
                odometerMeters: 14010293,
                safetyStatus: "safe",
                secondSignature: {
                    signatoryUser: { id: "88668", name: "Susan Bob" },
                    signedAtTime: "2020-01-27T07:06:25Z",
                    type: "driver",
                },
                startTime: "2020-01-27T07:06:25Z",
                thirdSignature: {
                    signatoryUser: { id: "88668", name: "Susan Bob" },
                    signedAtTime: "2020-01-27T07:06:25Z",
                    type: "driver",
                },
                trailer: { id: "123456789", name: "Midwest Trailer #5" },
                trailerDefects: [
                    {
                        comment: "Air Compressor not working",
                        createdAtTime: "2020-01-27T07:06:25Z",
                        defectType: "Air Compressor",
                        id: "18",
                        isResolved: true,
                        mechanicNotes: "Extremely large oddly shaped hole in passenger side window.",
                        mechanicNotesUpdatedAtTime: "2020-01-27T07:06:25Z",
                        resolvedAtTime: "2020-01-27T07:06:25Z",
                    },
                ],
                trailerName: "Midwest Trailer #5",
                type: "preTrip",
                vehicle: {
                    ExternalIds: { maintenanceId: "250020", payrollId: "ABFS18600" },
                    id: "123456789",
                    name: "Midwest Truck #4",
                },
                vehicleDefects: [
                    {
                        comment: "Air Compressor not working",
                        createdAtTime: "2020-01-27T07:06:25Z",
                        defectType: "Air Compressor",
                        id: "18",
                        isResolved: true,
                        mechanicNotes: "Extremely large oddly shaped hole in passenger side window.",
                        mechanicNotesUpdatedAtTime: "2020-01-27T07:06:25Z",
                        resolvedAtTime: "2020-01-27T07:06:25Z",
                    },
                ],
            },
        };
        server
            .mockEndpoint()
            .patch("/fleet/dvirs/id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.dvirs.update("id", {
            authorId: "11",
            isResolved: true,
        });
        expect(response).toEqual({
            data: {
                authorSignature: {
                    signatoryUser: {
                        id: "88668",
                        name: "Susan Bob",
                    },
                    signedAtTime: "2020-01-27T07:06:25Z",
                    type: "driver",
                },
                endTime: "2020-01-27T07:06:25Z",
                id: "7107471",
                licensePlate: "XHK1234",
                location: "350 Rhode Island St Ste. 400S, San Francisco, CA 94103",
                mechanicNotes: "Replaced headlight on passenger side.",
                odometerMeters: 14010293,
                safetyStatus: "safe",
                secondSignature: {
                    signatoryUser: {
                        id: "88668",
                        name: "Susan Bob",
                    },
                    signedAtTime: "2020-01-27T07:06:25Z",
                    type: "driver",
                },
                startTime: "2020-01-27T07:06:25Z",
                thirdSignature: {
                    signatoryUser: {
                        id: "88668",
                        name: "Susan Bob",
                    },
                    signedAtTime: "2020-01-27T07:06:25Z",
                    type: "driver",
                },
                trailer: {
                    id: "123456789",
                    name: "Midwest Trailer #5",
                },
                trailerDefects: [
                    {
                        comment: "Air Compressor not working",
                        createdAtTime: "2020-01-27T07:06:25Z",
                        defectType: "Air Compressor",
                        id: "18",
                        isResolved: true,
                        mechanicNotes: "Extremely large oddly shaped hole in passenger side window.",
                        mechanicNotesUpdatedAtTime: "2020-01-27T07:06:25Z",
                        resolvedAtTime: "2020-01-27T07:06:25Z",
                    },
                ],
                trailerName: "Midwest Trailer #5",
                type: "preTrip",
                vehicle: {
                    ExternalIds: {
                        maintenanceId: "250020",
                        payrollId: "ABFS18600",
                    },
                    id: "123456789",
                    name: "Midwest Truck #4",
                },
                vehicleDefects: [
                    {
                        comment: "Air Compressor not working",
                        createdAtTime: "2020-01-27T07:06:25Z",
                        defectType: "Air Compressor",
                        id: "18",
                        isResolved: true,
                        mechanicNotes: "Extremely large oddly shaped hole in passenger side window.",
                        mechanicNotesUpdatedAtTime: "2020-01-27T07:06:25Z",
                        resolvedAtTime: "2020-01-27T07:06:25Z",
                    },
                ],
            },
        });
    });
});
