// This file was auto-generated by Fern from our API Definition.

import { SamsaraClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("UsersClient", () => {
    test("listUserRoles", async () => {
        const server = mockServerPool.createServer();
        const client = new SamsaraClient({
            maxRetries: 0,
            token: "test",
            version: "2025-06-11",
            environment: server.baseUrl,
        });

        const rawResponseBody = {
            data: [{ id: "8a9371af-82d1-4158-bf91-4ecc8d3a114c", name: "Full Admin" }],
            pagination: { endCursor: "MjkY", hasNextPage: true },
        };
        server.mockEndpoint().get("/user-roles").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.users.listUserRoles();
        expect(response).toEqual({
            data: [
                {
                    id: "8a9371af-82d1-4158-bf91-4ecc8d3a114c",
                    name: "Full Admin",
                },
            ],
            pagination: {
                endCursor: "MjkY",
                hasNextPage: true,
            },
        });
    });

    test("listUsers", async () => {
        const server = mockServerPool.createServer();
        const client = new SamsaraClient({
            maxRetries: 0,
            token: "test",
            version: "2025-06-11",
            environment: server.baseUrl,
        });

        const rawResponseBody = {
            data: [
                {
                    authType: "default",
                    email: "user@company.com",
                    id: "123",
                    name: "Bob Smith",
                    roles: [{ expireAt: "2025-08-13T19:08:25Z" }],
                },
            ],
            pagination: { endCursor: "MjkY", hasNextPage: true },
        };
        server.mockEndpoint().get("/users").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.users.listUsers();
        expect(response).toEqual({
            data: [
                {
                    authType: "default",
                    email: "user@company.com",
                    id: "123",
                    name: "Bob Smith",
                    roles: [
                        {
                            expireAt: "2025-08-13T19:08:25Z",
                        },
                    ],
                },
            ],
            pagination: {
                endCursor: "MjkY",
                hasNextPage: true,
            },
        });
    });

    test("createUser", async () => {
        const server = mockServerPool.createServer();
        const client = new SamsaraClient({
            maxRetries: 0,
            token: "test",
            version: "2025-06-11",
            environment: server.baseUrl,
        });
        const rawRequestBody = {
            authType: "default",
            email: "user@company.com",
            name: "Bob Smith",
            roles: [{ roleId: "8a9371af-82d1-4158-bf91-4ecc8d3a114c" }],
        };
        const rawResponseBody = {
            data: {
                authType: "default",
                email: "user@company.com",
                id: "123",
                name: "Bob Smith",
                roles: [{ expireAt: "2025-08-13T19:08:25Z" }],
            },
        };
        server
            .mockEndpoint()
            .post("/users")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.users.createUser({
            authType: "default",
            email: "user@company.com",
            name: "Bob Smith",
            roles: [
                {
                    roleId: "8a9371af-82d1-4158-bf91-4ecc8d3a114c",
                },
            ],
        });
        expect(response).toEqual({
            data: {
                authType: "default",
                email: "user@company.com",
                id: "123",
                name: "Bob Smith",
                roles: [
                    {
                        expireAt: "2025-08-13T19:08:25Z",
                    },
                ],
            },
        });
    });

    test("getUser", async () => {
        const server = mockServerPool.createServer();
        const client = new SamsaraClient({
            maxRetries: 0,
            token: "test",
            version: "2025-06-11",
            environment: server.baseUrl,
        });

        const rawResponseBody = {
            data: {
                authType: "default",
                email: "user@company.com",
                id: "123",
                name: "Bob Smith",
                roles: [{ expireAt: "2025-08-13T19:08:25Z" }],
            },
        };
        server.mockEndpoint().get("/users/id").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.users.getUser("id");
        expect(response).toEqual({
            data: {
                authType: "default",
                email: "user@company.com",
                id: "123",
                name: "Bob Smith",
                roles: [
                    {
                        expireAt: "2025-08-13T19:08:25Z",
                    },
                ],
            },
        });
    });

    test("delete", async () => {
        const server = mockServerPool.createServer();
        const client = new SamsaraClient({
            maxRetries: 0,
            token: "test",
            version: "2025-06-11",
            environment: server.baseUrl,
        });

        const rawResponseBody = "";
        server.mockEndpoint().delete("/users/id").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.users.delete("id");
        expect(response).toEqual("");
    });

    test("updateUser", async () => {
        const server = mockServerPool.createServer();
        const client = new SamsaraClient({
            maxRetries: 0,
            token: "test",
            version: "2025-06-11",
            environment: server.baseUrl,
        });
        const rawRequestBody = {};
        const rawResponseBody = {
            data: {
                authType: "default",
                email: "user@company.com",
                id: "123",
                name: "Bob Smith",
                roles: [{ expireAt: "2025-08-13T19:08:25Z" }],
            },
        };
        server
            .mockEndpoint()
            .patch("/users/id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.users.updateUser("id");
        expect(response).toEqual({
            data: {
                authType: "default",
                email: "user@company.com",
                id: "123",
                name: "Bob Smith",
                roles: [
                    {
                        expireAt: "2025-08-13T19:08:25Z",
                    },
                ],
            },
        });
    });
});
